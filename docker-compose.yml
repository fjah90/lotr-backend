# ==============================================================================
# LOTR Backend - Docker Compose
# ==============================================================================
# Este archivo levanta SOLO el backend Node.js.
# La base de datos PostgreSQL es manejada por Supabase Local.
#
# PRERREQUISITO: Ejecutar primero `npx supabase start`
#
# Uso:
#   npx supabase start              # 1. Iniciar Supabase (PostgreSQL)
#   docker-compose up -d            # 2. Iniciar el backend
#   docker-compose logs -f api      # Ver logs
#   docker-compose down             # Detener backend
# ==============================================================================

services:
  # ============================================================================
  # Backend API (Node.js + Hono.js)
  # ============================================================================
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lotr-backend
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      NODE_ENV: production
      PORT: 3000
      # Conecta al PostgreSQL de Supabase (host.docker.internal apunta al host)
      DATABASE_URL: postgresql://postgres:postgres@host.docker.internal:54322/postgres
      ONE_API_KEY: ${ONE_API_KEY}
      ONE_API_BASE_URL: https://the-one-api.dev/v2
    extra_hosts:
      - "host.docker.internal:host-gateway"
